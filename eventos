import sqlite3
from flask import app, jsonify
from flask_login import login_required


@app.route('/eventos')
@login_required
def eventos():
    conn = sqlite3.connect('database.db')
    cursor = conn.cursor()

    cursor.execute(
        'SELECT id, nome, data, tipo, unidade, empreendimento FROM agendamentos')
    rows = cursor.fetchall()
    conn.close()

    eventos = []
    for row in rows:
        evento = {
            "id": row[0],
            "title": f"{row[1]} ({row[3]})",  # Ex.: Jo√£o (Entrega de chaves)
            "start": row[2]
        }
        eventos.append(evento)

    return jsonify(eventos)
