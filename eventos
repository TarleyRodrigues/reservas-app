import sqlite3
from flask import app, jsonify


@app.route('/eventos')
def eventos():
    # Conecta no banco SQLite
    conn = sqlite3.connect('database.db')
    cursor = conn.cursor()

    # Busca todos os agendamentos
    cursor.execute(
        'SELECT id, nome, data, tipo, unidade, empreendimento FROM agendamentos')
    rows = cursor.fetchall()
    conn.close()

    eventos = []
    for row in rows:
        evento = {
            "id": row[0],
            # Título que aparece no calendário: nome + tipo do agendamento
            "title": f"{row[1]} ({row[3]})",
            # Data do evento no formato YYYY-MM-DD
            "start": row[2]
        }
        eventos.append(evento)

    # Retorna lista de eventos em formato JSON para o FullCalendar consumir
    return jsonify(eventos)
