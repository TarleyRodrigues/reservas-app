{% extends 'base.html' %}

{% block title %}Fazer Agendamento{% endblock %}

{% block content %}
<div class="form-wrapper">
    <button class="theme-toggle" aria-label="Alternar modo claro e escuro" id="toggleTheme">🌙</button>

    <h2>Fazer Agendamento</h2>

    <a href="{{ url_for('calendario') }}" class="header-btn" style="display: inline-block; margin-bottom: 20px;">
        📅 Ver Calendário
    </a>

    <form method="POST" action="{{ url_for('agendar') }}">
        <label for="nome">Nome</label>
        <input id="nome" type="text" name="nome" placeholder="Digite seu nome" required>

        <label for="data">Data</label>
        <input id="data" type="date" name="data" required>

        <label for="hora">Hora</label>
        <input id="hora" type="time" name="hora" required>

        <label for="tipo">Tipo de agendamento</label>
        <select id="tipo" name="tipo_id" required>
            <option value="" disabled selected>Selecione o tipo</option>
            {% for tipo in tipos %}
                <option value="{{ tipo.id }}">{{ tipo.nome }}</option>
            {% endfor %}
        </select>

        <label for="empreendimento">Empreendimento</label>
        <select id="empreendimento" name="empreendimento_id" required>
            <option value="" disabled selected>Selecione o empreendimento</option>
            {% for emp in empreendimentos %}
                <option value="{{ emp.id }}">{{ emp.nome }}</option>
            {% endfor %}
        </select>

        <label for="unidade">Unidade</label>
        <select id="unidade" name="unidade_id" required>
            <option value="" disabled selected>Selecione a unidade</option>
            {% for unidade in unidades %}
                <option value="{{ unidade.id }}" data-emp="{{ unidade.empreendimento_id }}">
                    {{ unidade.nome }} ({{ unidade.empreendimento }})
                </option>
            {% endfor %}
        </select>

        <button type="submit" class="btn-agendar">Agendar</button>
    </form>
</div>

<script>
    // Toggle de tema
    const toggleBtn = document.getElementById('toggleTheme');
    const body = document.body;

    toggleBtn.addEventListener('click', () => {
        body.classList.toggle('dark');
        toggleBtn.textContent = body.classList.contains('dark') ? '☀️' : '🌙';
    });

    // Filtro de unidades por empreendimento
    document.getElementById('empreendimento').addEventListener('change', function() {
        const empId = this.value;
        const unidadesSelect = document.getElementById('unidade');
        
        // Resetar seleção
        unidadesSelect.value = '';
        
        // Mostrar apenas unidades do empreendimento selecionado
        unidadesSelect.querySelectorAll('option').forEach(opt => {
            if (!opt.value || opt.dataset.emp === empId) {
                opt.style.display = 'block';
            } else {
                opt.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}